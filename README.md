# 车辆轮廓检测项目

## 项目说明
本项目实现了基于OpenCV的车辆轮廓检测算法，通过Canny边缘检测和轮廓筛选，能够有效识别图像中的车辆。项目特别对不同尺寸的图像进行了优化处理，能够处理从小尺寸(100x100)到大尺寸图像的车辆识别。

## 实现思路

### 算法核心流程
1. **图像预处理**：
   - 图像灰度化
   - 高斯模糊（根据图像大小动态选择核大小）
   
2. **边缘检测**：
   - 使用Canny算子进行边缘检测
   - 小图像使用固定阈值(50-150)
   - 大图像使用自适应阈值（基于图像中位数的0.5-1.5倍）
   
3. **边缘增强**：
   - 使用形态学操作（膨胀和腐蚀）连接断开的边缘
   - 小图像使用2x2核，大图像使用3x3核
   
4. **轮廓检测与筛选**：
   - 使用OpenCV的findContours函数检测轮廓
   - 通过面积、宽高比、最小宽高等多条件筛选有效轮廓
   - 对于小图像，使用更宽松的参数条件
   
5. **特殊情况处理**：
   - 对于小图像，当没有检测到有效轮廓但有足够边缘点时，自动使用整体检测法

### 关键参数
- **小图像判定**：宽或高 < 200像素
- **高斯核大小**：小图像3×3，大图像5×5
- **最小宽高比例**：根据图像大小动态调整
- **最小面积比例**：小图像占总面积5%，大图像根据参数调整

### 核心优化点
- **动态参数调整**：根据图像尺寸自适应调整参数
- **形态学边缘增强**：连接断裂的车辆轮廓边缘
- **自适应边缘检测阈值**：根据图像特征自适应计算
- **多条件轮廓筛选**：结合面积、宽高比、填充率等多维特征
- **整体检测兜底方案**：针对小图像特殊处理

## 运行方法

### 环境要求
- Python 3.6+
- OpenCV
- NumPy

### 安装依赖
```bash
pip install opencv-python numpy
```

### 单图像处理
```bash
python main.py 图像路径.jpg
```

### 指定输出路径
```bash
python main.py -o 输出路径.jpg 图像路径.jpg
```

### 启用调试模式（显示轮廓详细信息）
```bash
python main.py -d 图像路径.jpg
```

### 批量处理目录中所有图像
```bash
python main.py -a 目录路径
```

## 输出文件
- **二值化边缘图**：`{原文件名}_binary.jpg`
- **检测结果图**：`{原文件名}_result.jpg`

## 示例
处理单张图像：
```bash
python main.py car.jpg
```

处理目录下所有图像：
```bash
python main.py -a ./images
```

## 代码结构

### 主要类
```python
class SimpleDetector:
    """简化版车辆轮廓检测器类"""
```

### 主要方法
- `detect(image_path, output_path=None, debug=False)`: 主检测函数
- `_detect_contours(edges, original_image, is_small_image=False)`: 检测和筛选轮廓

### 辅助函数
- `process_image(image_path, output_path=None, debug=False)`: 处理单张图像
- `process_directory(directory, debug=False)`: 处理目录中所有图像
- `main()`: 主函数，处理命令行参数

## 设计特点

1. **简单易用**：命令行参数设计直观，支持单图像和批量处理
2. **可视化结果**：输出包含边缘图和检测结果，方便分析
3. **自适应处理**：根据图像特征自动调整参数，无需人工干预
4. **特殊场景优化**：针对小图像和低质量图像有特殊处理逻辑

## 测试结果

项目已在多种车辆图像上进行了测试，包括：
- 小尺寸图像(100x100)
- 中等尺寸图像
- 不同颜色的车辆（包括白色车辆）

检测结果表明，该算法能够在各种场景下有效识别车辆轮廓。

## 后续改进方向

1. 引入机器学习方法，提高检测准确率
2. 优化多车辆场景下的检测能力
3. 添加车辆类型识别功能
4. 扩展到视频流处理